include:
  - local: stages/preprocess/base.yaml

# clone templates repo as an artifact so it can be used with other jobs
load scripts:
  extends: .preprocess
  cache: {}
  variables:
    IMAGE_VERSION_ARTIFACT: "version.env"
  script:
    - 'mkdir -p "${PIPELINE_REPO_DIR}"'
    - 'git clone -q --depth 1 --branch "${TARGET_BRANCH}" "https://repo1.dsop.io/ironbank-tools/ironbank-pipeline.git" "${PIPELINE_REPO_DIR}"'
    - 'rm -rf "${PIPELINE_REPO_DIR}/.git"'
    # - 'python3 "${PIPELINE_REPO_DIR}"/stages/preprocess/version.py --output "${IMAGE_VERSION_ARTIFACT}"'
    - 'python3 "${PIPELINE_REPO_DIR}"/stages/preprocess/special_path_lookup.py --output "${IMAGE_VERSION_ARTIFACT}"'
  artifacts:
    when: always
    expire_in: 1 day
    paths:
      - "${PIPELINE_REPO_DIR}"
    reports:
      dotenv: "${IMAGE_VERSION_ARTIFACT}"
