build:
  stage: build
  allow_failure: true
  # Need to convert from artifactory
  image: ${GITLAB_INTERNAL_REGISTRY}/dsop/ironbank-pipeline/all-in-one-fedora:1.0
  dependencies:
    - import artifacts
  variables:
    ARTIFACT_DIR: ${ARTIFACT_STORAGE}/build
  before_script:
    - mkdir -p ${ARTIFACT_DIR}
    - cp -r ${ARTIFACT_STORAGE}/import-artifacts/ .
  script:
    # - dnf install -y buildah
    # - buildah build 
    - echo "Temporary placeholder"
    # This will be replaced by actually building the image with the Dockerfile and required artifacts
    - podman pull --authfile=${DOCKER_AUTH_CONFIG} registry1.dsop.io/ironbank/opensource/kubernetes-1.18/kubectl-1.18:latest
    - podman save registry1.dsop.io/ironbank/opensource/kubernetes-1.18/kubectl-1.18:latest -o image.tar
    - mv image.tar ${ARTIFACT_DIR}
  artifacts:
    when: always
    paths:
      - ${ARTIFACT_DIR}/
