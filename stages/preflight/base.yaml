.preflight:
  stage: preflight
  image: "${GITLAB_INTERNAL_REGISTRY}/ironbank-tools/ironbank-pipeline/docker-git-bash-python:3.7"

  # Load in the IMG_VERSION variable from the load scripts env
  dependencies:
    - load scripts

# TODO: Possibly check for deployment files?
folder structure:
  extends: .preflight
  script:
    - |
        set -x
        [[ -f README.md ]] | tee output.txt
        [[ -f Dockerfile ]] | tee output.txt
        [[ -f "LICENSE" || -f "LICENSE.md" || -f "LICENSE.txt" || -f "LICENSE.adoc" ]] | tee output.txt
    - cat output.txt
    # - ls -l download.yaml || echo "No download.yaml found"
    # - ls -l scripts || echo "No download.yaml found"
    # - ls -l signatures || echo "No download.yaml found"
    # - ls -l config || echo "No download.yaml found"
    # - ls -l accreditation || echo "No download.yaml found"

# TODO: Check the following (among others):
# base image vars??
# OPTIONAL FOR BETA PIPELINE
build variables:
  extends: folder structure
  script:
    - '"${PIPELINE_REPO_DIR}/stages/preflight/check_base_vars.sh"'
