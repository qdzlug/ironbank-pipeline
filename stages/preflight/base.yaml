.preflight:
  stage: preflight
  image: ${GITLAB_INTERNAL_REGISTRY}/ironbank-tools/ironbank-pipeline/docker-git-bash-python:3.7

  # Load in the IMG_VERSION variable from the load scripts env
  dependencies:
    - load scripts

# TODO: Possibly check for deployment files?
folder structure:
  extends: .preflight
  script:
    - ls -l README.md
    - ls -l Dockerfile
    - ls -l LICENSE || ls -l LICENSE.md
    # - ls -l download.yaml || echo "No download.yaml found"
    # - ls -l scripts || echo "No download.yaml found"
    # - ls -l signatures || echo "No download.yaml found"
    # - ls -l config || echo "No download.yaml found"
    # - ls -l accreditation || echo "No download.yaml found"

# TODO: Check the following (among others):
# base image vars??
# OPTIONAL FOR BETA PIPELINE
build variables:
  extends: folder structure
  script:
    - |
      if [ -z "$IMG_VERSION" ]; then
        echo
        echo "ERROR: Missing IMG_VERSION variable. Do you have the appropriate files in your repository?"
        echo
        echo "ERROR: This is an easy thing to solve, please reference the previous stage (load scripts) as well as the MR below to resolve your issue."
        echo "ERROR: https://repo1.dsop.io/ironbank-tools/ironbank-pipeline/-/merge_requests/30"
        echo
        exit 1
      fi

