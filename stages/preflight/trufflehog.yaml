trufflehog:
  extends: .preflight
  dependencies: []
  image:
    name: registry1.dso.mil/ironbank/opensource/trufflehog/trufflehog:2.2.1
    entrypoint: [""]
  script:
    # Could add exceptions using --exclude_paths <exclusion file>
    # - git config http.postBuffer 524288000
    - set -x
    - 'trufflehog --regex --entropy False "file://${CI_PROJECT_DIR}"'
    # - SUCCESS=$?
    # - |
    #   if [ $SUCCESS -eq 0 ]; then
    #     exit 0
    #   fi
    # - 'echo "${WARNINGS}" | tee trufflehog.json'
    # - echo "FAILED Trufflehog scan. Exiting"
    # - exit "${SUCCESS}"
  artifacts:
    name: $CI_PROJECT_NAME-$CI_JOB_ID
    when: on_failure
    expire_in: 1 week
    paths:
      - trufflehog.json
