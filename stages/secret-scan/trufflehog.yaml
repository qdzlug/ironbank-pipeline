trufflehog:
  stage: secret-scan
  image: registry1.dso.mil/ironbank/opensource/trufflehog/trufflehog3:3.0.6
  needs:
    - load-scripts
  variables:
    # This forces the trufflehog job to NOT perform a shallow clone
    GIT_DEPTH: 0
  script:
    - 'python3 -m pip install --user --no-deps --no-build-isolation "${MODULES_REPO_DIR}"'
    - 'pip install --user --no-deps "${PIPELINE_REPO_DIR}"'
    - 'git config --global --add safe.directory "${CI_PROJECT_DIR}"'
    - 'python3 "${PIPELINE_REPO_DIR}/stages/secret-scan/trufflehog.py"'
