import-artifacts:
  stage: import-artifacts
  needs:
    - load-scripts
    - lint
    - job: trufflehog
      artifacts: false
  variables:
    ARTIFACT_DIR: "${ARTIFACT_STORAGE}/import-artifacts"
    REQUESTS_CA_BUNDLE: "/etc/pki/ca-trust/extracted/openssl/ca-bundle.trust.crt"
  script:
    - 'python3 -m pip install --user --no-deps --no-build-isolation "${MODULES_REPO_DIR}"'
    - 'echo "${REQUESTS_CA_BUNDLE}"'
    - 'mkdir -p "${ARTIFACT_DIR}/external-resources/" "${ARTIFACT_DIR}/images/"'
    - 'python3 "${PIPELINE_REPO_DIR}/stages/import-artifacts/downloader.py"'
  artifacts:
    when: always
    paths:
      - "${ARTIFACT_DIR}/"
    expire_in: 1 week
