# include:
#   - local: stages/scanning/base.yaml

anchore scan:
  extends: .scanning
  allow_failure: true
  image: ${REGISTRY_URL}/redhat/python/python36:3.6
  variables:
    # put all scan outputs in the scan-results folder
    ANCHORE_SCANS: ${ARTIFACT_STORAGE}/scan-results/anchore
  before_script:
    - mkdir -p "${ANCHORE_SCANS}"
  script:
    - python3 ${PIPELINE_REPO_DIR}/stages/scanning//Users/gavinscallon/repos/dccscr/ironbank-pipeline/stages/scanning/pipeline_anchore_vuln_report_gen.py
  artifacts:
    when: always
    paths:
      - ${ANCHORE_SCANS}/

# following code block borrowed from spacecamp as reference if needed
# anchore scan:
#   extends: .anchore scan
#   image: anchore/engine-cli:v0.5.0
#   variables:
#     ANCHORE_CLI_URL: ${ANCHORE_CLI_URL}
#     ANCHORE_CLI_USER: ${ANCHORE_CLI_USER}
#     ANCHORE_CLI_PASS: ${ANCHORE_CLI_PASS}
#     ANCHORE_CLI_SSL_VERIFY: "false"
#     ANCHORE_TIMEOUT: ${ANCHORE_TIMEOUT}
#     ANCHORE_FAIL_ON_POLICY: "false"

#  steps

#  retrieve current anchore version as needed

# add image to anchore cli, authenticate with creds

# use pipeline_anchore_vuln_report_gen.py to generatr anchore report

# archive artifacts as needed (such as anchore version text file - i.e. the stuff used by VAT and IBFE)