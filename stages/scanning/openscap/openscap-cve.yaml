openscap cve rhel:
  stage: scanning
  extends: .scanning
  before_script:
    - "${PIPELINE_REPO_DIR}/stages/scanning/openscap/base_image_type.sh"
  rules:
    - if: '$UBUNTU == "1"'
      when: never
    - if: '$DISTROLESS == "1"'
      when: never
    - when: on_success
  # Load in the IMG_VERSION variable from load scripts env
  dependencies:
    - load scripts
    - build
  variables:
    ARTIFACT_DIR: "${ARTIFACT_STORAGE}/scan-results/openscap"
  script:
    - '"${PIPELINE_REPO_DIR}/stages/scanning/openscap/oscap-cve-run.sh"'
  artifacts:
    when: always
    paths:
      - "${ARTIFACT_DIR}"
    reports:
      dotenv: oscap-cve.env

openscap cve ubuntu:
  stage: scanning
  extends: .scanning
  before_script:
    - "${PIPELINE_REPO_DIR}/stages/scanning/openscap/base_image_type.sh"
  image: "${GITLAB_INTERNAL_REGISTRY}/ironbank-tools/ironbank-pipeline/ubupodscap1804:1.3.2"
  rules:
    - if: '$UBUNTU != "1"'
      when: never
    - if: '$DISTROLESS == "1"'
      when: never
    - when: on_success
  # Load in the IMG_VERSION variable from load scripts env
  dependencies:
    - load scripts
    - build
  variables:
    ARTIFACT_DIR: "${ARTIFACT_STORAGE}/scan-results/openscap"
  script:
    - '"${PIPELINE_REPO_DIR}/stages/scanning/openscap/oscap-cve-run.sh"'
  artifacts:
    when: always
    paths:
      - "${ARTIFACT_DIR}"
    reports:
      dotenv: oscap-cve.env
