{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "$id": "https://repo1.dsop.io/ironbank-tools/ironbank-pipeline/schema/hardening_manifest.schema.json",
  "definitions": {
    "printable-characters-without-newlines": {
      "type": "string",
      "pattern": "^[ -~]*$",
      "minLength": 1
    },
    "docker-TagRegexp": {
      "$comment": "https://github.com/docker/distribution/blob/master/reference/regexp.go",
      "type": "string",
      "pattern": "^[\\w][\\w.-]{0,127}$"
    },
    "docker-name-and-tag": {
      "$comment": "https://github.com/docker/distribution/blob/master/reference/regexp.go",
      "type": "string",
      "pattern": "^[a-z0-9]+(?:(?:(?:[._]|__|[-]*)[a-z0-9]+)+)?(?:(?:/[a-z0-9]+(?:(?:(?:[._]|__|[-]*)[a-z0-9]+)+)?)+)?:[\\w][\\w.-]{0,127}$"
    },
    "docker-DigestRegexp": {
      "$comment": "https://github.com/docker/distribution/blob/master/reference/regexp.go",
      "type": "string",
      "pattern": "[A-Za-z][A-Za-z0-9]*(?:[-_+.][A-Za-z][A-Za-z0-9]*)*[:][[:xdigit:]]{32,}"
    },
    "timestamp": {
      "type": "string",
      "pattern": "[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]) (2[0-3]|[01][0-9]):[0-5][0-9]"
    }
  },
  "title": "IronBank Finding",
  "description": "IronBank Findings and Schema",
  "type": "object",
  "properties": {
    "image": {
      "$ref": "#/definitions/docker-name-and-tag"
    },
    "digest": {
      "type": "string"
    },
    "timestamp": {
      "$ref": "#/definitions/timestamp"
    },
    "repo": {
      "type": "object",
      "properties": {
        "url": {
          "type": "string"
        },
        "commit": {
          "type": "string"
        }
      }
    },
    "tools": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "enum": ["anchore", "openscap_cve", "openscap_oval", "twistlock"]
          },
          "version": {
            "type": "string"
          }
        }
      },
      "uniqueItems": true
    },
    "findings": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "package": {
            "type": "string"
          },
          "path": {
            "type": "string"
          },
          "tool": {
            "type": "string",
            "enum": ["anchore", "openscap_cve", "openscap_oval", "twistlock"]
          }
        }
      },
      "uniqueItems": true
    }
  },
  "required": ["image", "digest", "timestamp", "repo", "tools", "findings"]
}

